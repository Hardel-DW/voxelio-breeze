<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voxel Breeze - D√©mo Enchantement</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>‚öîÔ∏è D√©mo Enchantement Simulator</h1>
        
        <div class="demo-grid">
            <!-- Configuration -->
            <div class="panel">
                <h2>‚öôÔ∏è Configuration</h2>
                
                <div class="form-group">
                    <label for="item-select">Item :</label>
                    <select id="item-select">
                        <option value="sword">√âp√©e de diamant</option>
                        <option value="book">Livre</option>
                        <option value="bow">Arc</option>
                        <option value="pickaxe">Pioche de diamant</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="bookshelves">Nombre d'√©tag√®res (0-15) :</label>
                    <input type="number" id="bookshelves" min="0" max="15" value="15">
                </div>

                <div class="form-group">
                    <label for="enchantability">Enchantabilit√© de l'item :</label>
                    <input type="number" id="enchantability" min="1" max="25" value="10">
                </div>

                <button onclick="simulateEnchantment()">üé≤ Simuler Table d'Enchantement</button>
                <button onclick="calculateProbabilities()">üìä Calculer Probabilit√©s</button>
            </div>

            <!-- R√©sultats -->
            <div class="panel">
                <h2>üìã R√©sultats</h2>
                <div id="results" class="results">
                    Cliquez sur un bouton pour commencer la simulation...
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { EnchantmentSimulator } from '../../dist/core.js';
        import { enchantment, exclusivityTags } from './mock.js';

        const items = {
            sword: {
                id: "minecraft:diamond_sword",
                enchantability: 10,
                tags: [
                    "minecraft:swords",
                    "minecraft:enchantable/sword",
                    "minecraft:enchantable/sharp_weapon",
                    "minecraft:enchantable/weapon",
                    "minecraft:enchantable/fire_aspect",
                    "minecraft:enchantable/durability"
                ]
            },
            book: {
                id: "minecraft:book",
                enchantability: 1,
                tags: ["minecraft:enchantable/durability"]
            },
            bow: {
                id: "minecraft:bow",
                enchantability: 1,
                tags: ["minecraft:enchantable/bow", "minecraft:enchantable/durability"]
            },
            pickaxe: {
                id: "minecraft:diamond_pickaxe",
                enchantability: 10,
                tags: ["minecraft:enchantable/mining", "minecraft:enchantable/durability"]
            }
        };

        let simulator;

        
        try {
            simulator = new EnchantmentSimulator(enchantment, exclusivityTags);
        } catch (error) {
            console.error('Erreur lors de l\'initialisation:', error);
            document.getElementById('results').innerHTML = `<div class="error">Erreur : ${error.message}</div>`;
        }

        window.simulateEnchantment = function() {
            try {
                const itemType = document.getElementById('item-select').value;
                const bookshelves = parseInt(document.getElementById('bookshelves').value);
                const enchantability = parseInt(document.getElementById('enchantability').value);
                
                const item = { ...items[itemType], enchantability };
                
                console.log('Item tags:', item.tags);
                console.log('Available enchantments:', Array.from(enchantment.keys()));
                
                const options = simulator.simulateEnchantmentTable(bookshelves, enchantability, item.tags);
                console.log('Options result:', options);
                
                let html = `<h3>üéØ Options d'enchantement pour ${item.id}</h3>`;
                
                options.forEach((option, index) => {
                    html += `
                        <div class="enchantment-option">
                            <h4>Slot ${index + 1} - Niveau ${option.level} (${option.cost} XP)</h4>
                            ${option.enchantments.map(ench => 
                                `<div>‚Ä¢ ${ench.enchantment} ${ench.level}</div>`
                            ).join('')}
                        </div>
                    `;
                });
                
                document.getElementById('results').innerHTML = html;
            } catch (error) {
                document.getElementById('results').innerHTML = `<div class="error">Erreur : ${error.message}</div>`;
            }
        };

        window.calculateProbabilities = function() {
            try {
                const itemType = document.getElementById('item-select').value;
                const bookshelves = parseInt(document.getElementById('bookshelves').value);
                const enchantability = parseInt(document.getElementById('enchantability').value);
                
                const item = { ...items[itemType], enchantability };
                console.log(item);
                
                const probabilities = simulator.calculateEnchantmentProbabilities(
                    bookshelves, 
                    enchantability, 
                    item.tags,
                    1000 // 1000 simulations
                );
                
                let html = `<h3>üìä Probabilit√©s d'enchantement pour ${item.id}</h3>`;
                
                probabilities.forEach((stat) => {
                    const percentage = stat.probability.toFixed(1);
                    html += `
                        <div class="enchantment-option">
                            <h4>${stat.enchantmentId}</h4>
                            <div class="probability-container">
                                <div class="probability-text">
                                    ${percentage}% (Niveau moyen: ${stat.averageLevel.toFixed(1)})
                                </div>
                                <div class="probability-bar">
                                    <div class="probability-fill" style="width: ${percentage}%"></div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('results').innerHTML = html;
            } catch (error) {
                document.getElementById('results').innerHTML = `<div class="error">Erreur : ${error.message}</div>`;
            }
        };

        // Auto-update enchantability when item changes
        document.getElementById('item-select').addEventListener('change', function() {
            const itemType = this.value;
            document.getElementById('enchantability').value = items[itemType].enchantability;
        });
    </script>
</body>
</html> 